(()=>{"use strict";var o={718:(o,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Board=void 0;var i=t(950),r=function(){function o(o){this.game=o,this.ratio=100,this.side_length=.01*this.ratio*i.SIDE_LENGTH,this.target_coordinate=[-1,-1],this.intersections=new Array;for(var e=0;e<9;e++){this.intersections[e]=[];for(var t=0;t<10;t++)this.intersections[e][t]=new i.Point(e+1,t+1)}}return o.prototype.movePieceFromSrcToDest=function(o,e,t){e.setPiece(null),o.moveToPoint(t),t.setPiece(o)},o.prototype.getPointFromCoordinates=function(o,e){return this.validateXCoordinate(o)&&this.validateYCoordinate(e)?this.intersections[o-1][e-1]:null},o.prototype.getCoordinateFromElemId=function(o){console.log(o);var e=o.split("_"),t=e[2],i=e[3];return[parseInt(t),parseInt(i)]},o.prototype.validateXCoordinate=function(o){return o>=1&&o<=9},o.prototype.validateYCoordinate=function(o){return o>=1&&o<=10},o.prototype.getRowFromYCoordinate=function(o){for(var e=[],t=0;t<9;t++)e.push(this.intersections[t][o-1]);return e},o.prototype.getColFromXCoordinate=function(o){for(var e=[],t=0;t<10;t++)e.push(this.intersections[o-1][t]);return e},o.prototype.detectZoom=function(){var o=0;void 0!==window.devicePixelRatio?o=window.devicePixelRatio:void 0!==window.outerWidth&&void 0!==window.innerWidth&&(o=window.outerWidth/window.innerWidth),o&&(o=Math.round(100*o)),this.ratio=o},o.prototype.render=function(){var o=$("#board");$("#id_chessboard").css("position","fixed"),$("#id_chessboard").css("max-height","100vh"),$("#id_chessboard").css("margin","0"),$("#id_chessboard").css("padding","0vw"),o.css("margin-left","auto"),o.css("margin-right","auto"),o.css("padding",0),$(".className_grid_div").css("background-color","rgba(255,0,0,0.3)"),$(window).on("resize",(function(){i.fitSize()})),$(document).on("ready",(function(){i.fitSize()})),$("#board").css("max-width","100vh")},o}();e.Board=r},884:function(o,e,t){var i,r=this&&this.__extends||(i=function(o,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,e){o.__proto__=e}||function(o,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[t]=e[t])})(o,e)},function(o,e){function t(){this.constructor=o}i(o,e),o.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),n=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.BlackChariot=e.RedChariot=void 0;var s=n(t(102)),a=t(476),c=function(o){function e(e,t,i){return o.call(this,e,t,a.PieceRole.General,i)||this}return r(e,o),e.prototype.canMove=function(e){var t=e.x_coor,i=e.y_coor;return!(!this.isValidChariotPosition(t,i)||Math.abs(t-this.point.x_coor)>1||Math.abs(i-this.point.y_coor)>1||o.prototype.checkSameColorPieceInPoint.call(this,e))},e}(a.Piece),l=function(o){function e(e,t){var i=o.call(this,t,e,a.PlayerColor.RED)||this;return i.elem.src="../img/pieces/red-ju.png",i.board=e,i.point.setPiece(i),$(i.elem).on("click",(function(){i.movablePoints()})),i}return r(e,o),e.prototype.movablePoints=function(){var o=[];return(o=o.concat(this.checkRow())).concat(this.checkColumn())},e.prototype.checkColumn=function(){s.default.trace("in checkColumns");var o=this.point.y_coor,e=(this.point.x_coor,this.board.getColFromXCoordinate(this.point.x_coor)),t=(this.board.getRowFromYCoordinate(this.point.y_coor),0),i=9;for(var r in e)if(null!=e[r].piece)if(parseInt(r)<o-1)(t=e[r].piece.color==a.PlayerColor.RED?parseInt(r)+1:parseInt(r))===o-1&&(t=o);else if(parseInt(r)>o-1){(i=e[r].piece.color==a.PlayerColor.RED?parseInt(r)-1:parseInt(r))===o-1&&(i=o-2);break}for(var n=[],c=t;c<=i;c++)o-1!==c&&n.push(e[c]);return n},e.prototype.checkRow=function(){s.default.trace("in checkRows()");var o=this.point.x_coor,e=this.board.getRowFromYCoordinate(this.point.y_coor),t=0,i=8;for(var r in e)if(null!=e[r].piece)if(parseInt(r)<o-1)(t=e[r].piece.color==a.PlayerColor.RED?parseInt(r)+1:parseInt(r))===o-1&&(t=o),s.default.trace("start_flag:"+t);else if(parseInt(r)>o-1){(i=e[r].piece.color==a.PlayerColor.RED?parseInt(r)-1:parseInt(r))===o-1&&(i=o-2),s.default.trace("end_flag:"+i);break}for(var n=[],c=t;c<=i;c++)o-1!==c&&n.push(e[c]);return n},e.prototype.isValidChariotPosition=function(o,e){return e>=8&&e<=10&&o>=4&&o<=6&&!(o>0&&e>0)},e}(c);e.RedChariot=l;var d=function(o){function e(e,t){var i=o.call(this,t,e,a.PlayerColor.BLACK)||this;return i.elem.src="../img/pieces/black-ju.png",i.board=e,i.point.setPiece(i),i}return r(e,o),e.prototype.movablePoints=function(){var o=[];return(o=o.concat(this.checkRow())).concat(this.checkColumn())},e.prototype.checkColumn=function(){s.default.trace("in checkColumns");var o=this.point.y_coor,e=(this.point.x_coor,this.board.getColFromXCoordinate(this.point.x_coor)),t=(this.board.getRowFromYCoordinate(this.point.y_coor),0),i=9;for(var r in e)if(null!=e[r].piece)if(parseInt(r)<o-1)(t=e[r].piece.color==a.PlayerColor.BLACK?parseInt(r)+1:parseInt(r))===o-1&&(t=o);else if(parseInt(r)>o-1){(i=e[r].piece.color==a.PlayerColor.BLACK?parseInt(r)-1:parseInt(r))===o-1&&(i=o-2);break}for(var n=[],c=t;c<=i;c++)o-1!==c&&n.push(e[c]);return console.log(n),n},e.prototype.checkRow=function(){s.default.trace("in checkRows()");var o=this.point.x_coor,e=this.board.getRowFromYCoordinate(this.point.y_coor),t=0,i=8;for(var r in e)if(null!=e[r].piece)if(parseInt(r)<o-1)(t=e[r].piece.isFriendly()?parseInt(r)+1:parseInt(r))===o-1&&(t=o),s.default.trace("start_flag:"+t);else if(parseInt(r)>o-1){(i=e[r].piece.isFriendly()?parseInt(r)-1:parseInt(r))===o-1&&(i=o-2),s.default.trace("end_flag:"+i);break}for(var n=[],a=t;a<=i;a++)o-1!==a&&n.push(e[a]);return console.log(n),n},e.prototype.isValidChariotPosition=function(o,e){return e>=0&&e<=10&&o>=0&&o<=9&&!(o>0&&e>0)},e}(c);e.BlackChariot=d},476:function(o,e,t){var i=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerColor=e.PieceRole=e.Piece=void 0;var r,n,s=i(t(102)),a=t(950);!function(o){o[o.BLACK=0]="BLACK",o[o.RED=1]="RED"}(r||(r={})),e.PlayerColor=r,function(o){o[o.General=0]="General",o[o.Advisor=1]="Advisor",o[o.Elephant=2]="Elephant",o[o.Chariot=3]="Chariot",o[o.Horse=4]="Horse",o[o.Cannon=5]="Cannon",o[o.Soldier=6]="Soldier"}(n||(n={})),e.PieceRole=n;var c=function(){function o(o,e,t,i){this.point=o,this.active=!1,this.board=e,this.piece_role=t,this.color=i,this.elem=document.createElement("img"),this.ratio=100,this.side_length=.01*this.ratio*a.SIDE_LENGTH,this.state=0,$(window).on("mousedown",(function(o){o.preventDefault()})),$(window).on("change",(function(o){o.preventDefault(),console.log("changed")})),this.listenerManager()}return o.prototype.listenerManager=function(){this.attachSelectPieceListener()},o.prototype.attachSelectPieceListener=function(){var o=this;$(this.elem).on("click",(function(e){console.log("点击了棋子："),console.log(o.elem),e.preventDefault(),$(".className_grid_div").css("background","rgba(3, 181, 252,0.0)"),o.movablePoints().forEach((function(o){$(o.elem).css("background","rgba(3, 181, 252,0.5")})),o.active=!0,o.board.active_piece=o,setTimeout((function(){o.attachMoveToGridListener()}),100)}))},o.prototype.attachMoveToGridListener=function(){var o=this;console.log(this.point),$(".className_grid_div").on("click",(function(e){if(console.log("点击了格子:"),console.log(e.target),o.board.active_piece&&o.board.game.getCurrentPlayer()==o.color){if(console.log("the piece is selected?"+o.active),console.log("active piece:"),console.log(o.board.active_piece),console.log(o.board.target_coordinate),o.board.target_coordinate=o.board.getCoordinateFromElemId(e.target.id),-1!=o.board.target_coordinate[0]&&-1!=o.board.target_coordinate[1]){console.log(o.board.target_coordinate);var t=o.board.target_coordinate[0],i=o.board.target_coordinate[1];o.board.active_piece.moveToPoint(o.board.getPointFromCoordinates(t,i)),$(".className_grid_div").css("background","rgba(0,0,0,0.0)"),o.board.target_coordinate=[-1,-1],o.active=!1,console.log("the piece is selected?"+o.active),console.log("active piece:"),console.log(o.board.active_piece),console.log(o.board.target_coordinate),o.board.game.alternatePlayer()}}else console.log("还没有选择棋子......"),console.log("Is the piece is selected? "+o.active),console.log("Doing nothing..."),$(".className_grid_div").css("background","rgba(0,0,0,0.0)");o.removeMoveToGridListener()}))},o.prototype.removeMoveToGridListener=function(){this.board.active_piece=null,console.log("已经点击了移动目标格,现在移除MoveToGridListener"),$(".className_grid_div").off("click"),$(".className_grid_div").css("background","rgba(0,0,0,0.0)")},o.prototype.movablePoints=function(){return s.default.trace("movable points of a piece"),[]},o.prototype.getElement=function(){return this.elem},o.prototype.moveToPoint=function(o){this.board.intersections[this.point.x_coor-1][this.point.y_coor-1].elem.remove(this.elem),this.point=o,this.board.intersections[this.point.x_coor-1][this.point.y_coor-1].elem.append(this.elem),console.log(this.board.intersections),console.log(this.point),console.log(this.point.x_coor),console.log(this.point.y_coor)},o.prototype.getRole=function(){return this.piece_role},o.prototype.getColor=function(){return this.color},o.prototype.checkSameColorPieceInPoint=function(o){var e=o.getPiece();return!!e&&e.getColor()===this.color},o.prototype.isFriendly=function(o){return!!o&&o.getColor()===this.color},o.prototype.isEnemy=function(o){return!!o&&o.getColor()!=this.color},o.prototype.render=function(){this.board.intersections[this.point.x_coor-1][this.point.y_coor-1].elem.append(this.elem),$(this.elem).addClass("pieces"),$(this.elem).addClass(n[this.piece_role].toString()),$(this.elem).addClass(r[this.color].toString())},o.adjustResize=function(){screen.width==window.innerWidth?(console.log("at exact 100%"),a.getChessBoardSize(),$(".className_grid_div").css("width",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".className_grid_div").css("height",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".pieces").css("width",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".pieces").css("height",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$("#board").css("width",$("#board").css("height")),$("#id_chessboard").css("width",$("#board").css("width"))):screen.width>window.innerWidth?(console.log("you have zoomed in the page i.e more than 100%"),a.getZoomedRatio(),a.getChessBoardSize(),$(".className_grid_div").css("width",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".className_grid_div").css("height",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".pieces").css("width",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".pieces").css("height",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$("#board").css("width",$("#board").css("height")),$("#id_chessboard").css("width",$("#board").css("width"))):(console.log("you have zoomed out i.e less than 100%"),a.getZoomedRatio(),a.getChessBoardSize(),$(".className_grid_div").css("width"),$(".className_grid_div").css("width",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".className_grid_div").css("height",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".pieces").css("width",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$(".pieces").css("height",a.SIDE_LENGTH*(a.getZoomedRatio()/100)),$("#board").css("width",$("#board").css("height")),$("#id_chessboard").css("width",$("#board").css("width")))},o}();e.Piece=c},20:(o,e,t)=>{var i=t(718),r=t(884),n=t(950),s=t(360);(new(function(){function o(){this.currentPlayer=n.PlayerColor.RED,this.board=new i.Board(this)}return o.prototype.getCurrentPlayer=function(){return this.currentPlayer},o.prototype.alternatePlayer=function(){this.currentPlayer===n.PlayerColor.RED?this.currentPlayer=n.PlayerColor.BLACK:this.currentPlayer=n.PlayerColor.RED},o.prototype.render=function(){this.board.render(),new s.RedGeneral(this.board,this.board.getPointFromCoordinates(5,10)).render(),new s.BlackGeneral(this.board,this.board.getPointFromCoordinates(5,1)).render();var o=new r.RedChariot(this.board,this.board.getPointFromCoordinates(1,10)),e=new r.RedChariot(this.board,this.board.getPointFromCoordinates(9,10)),t=new r.BlackChariot(this.board,this.board.getPointFromCoordinates(1,1)),i=new r.BlackChariot(this.board,this.board.getPointFromCoordinates(9,1));o.render(),e.render(),t.render(),i.render()},o}())).render()},360:function(o,e,t){var i,r=this&&this.__extends||(i=function(o,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,e){o.__proto__=e}||function(o,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[t]=e[t])})(o,e)},function(o,e){function t(){this.constructor=o}i(o,e),o.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(e,"__esModule",{value:!0}),e.BlackGeneral=e.RedGeneral=void 0;var n=t(476),s=function(o){function e(e,t,i){return o.call(this,e,t,n.PieceRole.General,i)||this}return r(e,o),e.prototype.canMove=function(e){var t=e.x_coor,i=e.y_coor;return!(!this.isValidGeneralPosition(t,i)||Math.abs(t-this.point.x_coor)>1||Math.abs(i-this.point.y_coor)>1||o.prototype.checkSameColorPieceInPoint.call(this,e))},e}(n.Piece),a=function(o){function e(e,t){var i=o.call(this,t,e,n.PlayerColor.RED)||this;return i.elem.src="../img/pieces/red-shuai.png",i.board=e,i.point.setPiece(i),i}return r(e,o),e.prototype.checkColumns=function(){var o=this.point.y_coor,e=this.point.x_coor,t=this.board.getPointFromCoordinates(e,o-1);this.board.getPointFromCoordinates(e,o+1),t&&(console.log("front.getPiece()"),console.log(t.getPiece())),console.log(this.board.getColFromXCoordinate(e))},e.prototype.checkRows=function(){var o=this.point.y_coor,e=this.point.x_coor,t=this.board.getPointFromCoordinates(e,o-1);this.board.getPointFromCoordinates(e,o+1),t&&(console.log("front.getPiece()"),console.log(t.getPiece())),console.log(this.board.getColFromXCoordinate(e))},e.prototype.isValidGeneralPosition=function(o,e){return e>=8&&e<=10&&o>=4&&o<=6&&!(o>0&&e>0)},e}(s);e.RedGeneral=a;var c=function(o){function e(e,t){var i=o.call(this,t,e,n.PlayerColor.BLACK)||this;return i.elem.src="../img/pieces/black-jiang.png",i.board=e,i.point.setPiece(i),i}return r(e,o),e.prototype.isValidGeneralPosition=function(o,e){return e>=1&&e<=3&&o>=4&&o<=6&&!(o>0&&e>0)},e}(s);e.BlackGeneral=c},950:function(o,e,t){var i=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(e,"__esModule",{value:!0}),e.PlayerColor=e.SIDE_LENGTH_vw=e.SIDE_LENGTH=e.Point=e.fitSize=e.getChessBoardSize=e.getZoomedRatio=void 0;var r,n=i(t(102));function s(){var o=0;return void 0!==window.devicePixelRatio?o=window.devicePixelRatio:void 0!==window.outerWidth&&void 0!==window.innerWidth&&(o=window.outerWidth/window.innerWidth),o&&(o=Math.round(100*o)),o}!function(o){o[o.BLACK=0]="BLACK",o[o.RED=1]="RED"}(r||(r={})),e.PlayerColor=r,e.getZoomedRatio=s,e.getChessBoardSize=function(){n.default.trace("chessboard size:");var o=$("#id_chessboard");n.default.trace("chessboad width"),n.default.trace(o.css("width")),n.default.trace("chessboad height"),n.default.trace(o.css("height"))};var a=function(){function o(o,e){this.x_coor=o,this.y_coor=e,this.elem=document.createElement("div"),this.updateElement(o,e)}return o.prototype.setPiece=function(o){this.piece=o},o.prototype.hasPiece=function(){return!!this.piece},o.prototype.getPiece=function(){return this.piece},o.prototype.updateElement=function(o,e){var t=this.elem,i=this.x_coor,r=this.y_coor;t.id="grid_div_"+i+"_"+r,$("#"+t.id).remove(),t.className="className_grid_div",$(t).css("grid-column",o),$(t).css("grid-row",e),$("#board").append(t)},o}();e.Point=a,e.SIDE_LENGTH=75;var c=70/(.01*s());e.SIDE_LENGTH_vw=c,e.fitSize=function(){var o=$("#board");$.when(o).then((function(){console.log("background-size"),console.log(o.css("background-size")),o.css("width",o.css("height")),o.css("height",o.css("width")),o.css("column-gap","0px"),console.log(o.css("row-gap"))})).then((function(){$(".className_grid_div").css("width",parseInt(o.css("width"))/11),$(".className_grid_div").css("height",parseInt(o.css("height"))/10),$(".className_grid_div").css("z-index",10),$(".className_grid_div").css("margin",0)})).then((function(){$(".pieces").css("width",parseInt($(".className_grid_div").css("width"))),$(".pieces").css("height",parseInt($(".className_grid_div").css("width")))})).then((function(){o.css("max-width",o.css("height"))}))}},102:function(o,e){var t=this&&this.__spreadArrays||function(){for(var o=0,e=0,t=arguments.length;e<t;e++)o+=arguments[e].length;var i=Array(o),r=0;for(e=0;e<t;e++)for(var n=arguments[e],s=0,a=n.length;s<a;s++,r++)i[r]=n[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function o(){}return o.trace=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];console.log.apply(console,t(["<T> "+(new Date).toLocaleString()+":"],o))},o.info=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];console.info.apply(console,t(["<I> "+(new Date).toLocaleString()+":"],o))},o.warn=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];console.warn.apply(console,t(["<W> "+(new Date).toLocaleString()+":"],o))},o.error=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];console.error.apply(console,t(["<E> "+(new Date).toLocaleString()+":"],o))},o.test=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];console.log.apply(console,t(["<X> "+(new Date).toLocaleString()+":"],o))},o}();e.default=i}},e={};!function t(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return o[i].call(r.exports,r,r.exports,t),r.exports}(20)})();
//# sourceMappingURL=bundle.js.map